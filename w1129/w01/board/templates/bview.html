{% load static %}
<!DOCTYPE html>
<html>
<head>
<title> JARDIN SHOP </title>
<meta charset="UTF-8" />
<meta name="csrf-token" content="{{ csrf_token }}">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="JARDIN SHOP" />
<meta name="keywords" content="JARDIN SHOP" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scaleable=no" />
<link rel="stylesheet" type="text/css" href="{% static '/css/reset.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static '/css/layout.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static '/css/content.css' %}" />
<script type="text/javascript" src="{% static '/js/jquery.min.js'%}"></script>
<script type="text/javascript" src="{% static '/js/top_navi.js'%}"></script>
<script type="text/javascript" src="{% static '/js/main.js'%}"></script>
<script type="text/javascript" src="{% static '/js/common.js'%}"></script>
<script type="text/javascript" src="{% static '/js/jquery.easing.1.3.js'%}"></script>
<script type="text/javascript" src="{% static '/js/idangerous.swiper-2.1.min.js'%}"></script>
<script type="text/javascript" src="{% static '/js/jquery.anchor.js'%}"></script>
<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
	


});
</script>
</head>
<body>

<div id="allwrap">
<div id="wrap">

	<div id="header">
		
		<div id="snbBox">
			<a href="/"><h1><img src="/static/images/txt/logo.gif" alt="JARDIN SHOP" /></h1></a>
			<div id="quickmenu">
				<div id="mnaviOpen"><img src="/static/images/btn/btn_mnavi.gif" width="33" height="31" alt="메뉴열기" /></div>
				<div id="mnaviClose"><img src="/static/images/btn/btn_mnavi_close.gif" width="44" height="43" alt="메뉴닫기" /></div>
				<ul>
					<li><a href="#">EVENT</a></li>
					<li><a href="#">CUSTOMER</a></li>
					<li><a href="#">COMMUNITY</a></li>
				</ul>
			</div>
			<div id="snb">
				<ul>
					<li><a href="#">LOGIN</a></li>
					<li><a href="#">JOIN</a></li>
					<li><a href="#">MY PAGE</a></li>
					<li><a href="#">CART</a></li>
				</ul>

				<div id="search">
					<input type="text" class="searchType" />
					<input type="image" src="/static/images/btn/btn_main_search.gif" width="23" height="20" alt="검색하기" />
				</div>
			</div>
		</div>
	</div>


	<!-- GNB -->
	<div id="gnb">
		
		<div id="top">
			<ul>
				<li class="brand t1"><a href="#" id="topNavi1">JARDIN’s BRAND</a>
					<ul id="topSubm1">
						<li><a href="#">클래스</a></li>
						<li><a href="#">홈스타일 카페모리</a></li>
						<li><a href="#">드립커피백</a></li>
						<li><a href="#">카페리얼 커피</a></li>
						<li><a href="#">오리지널커피백</a></li>
						<li><a href="#">카페리얼 음료</a></li>
						<li><a href="#">마일드커피백</a></li>
						<li><a href="#">워터커피</a></li>
						<li><a href="#">카페포드</a></li>
						<li><a href="#">모히또파티</a></li>
						<li><a href="#">테이크아웃 카페모리</a></li>
						<li><a href="#">포타제</a></li>
					</ul>
				</li>
				<li class="t2"><a href="#" id="topNavi2">원두</a>
					<ul id="topSubm2">
						<li><a href="#">클래스</a></li>
						<li><a href="#">로스터리샵</a></li>
						<li><a href="#">커피휘엘</a></li>
						<li><a href="#">산지별 생두</a></li>
					</ul>
				</li>
				<li class="t1"><a href="#" id="topNavi3">원두커피백</a>
					<ul id="topSubm3">
						<li><a href="#">드립커피 로스트</a></li>
						<li><a href="#">오리지널커피백</a></li>
						<li><a href="#">마일드커피백</a></li>
					</ul>
				</li>
				<li class="t2"><a href="#" id="topNavi4">인스턴트</a>
					<ul id="topSubm4">
						<li><a href="#">까페모리</a></li>
						<li><a href="#">홈스타일카페모리</a></li>
						<li><a href="#">포타제</a></li>
					</ul>
				</li>
				<li class="t1"><a href="#" id="topNavi5">음료</a>
					<ul id="topSubm5">
						<li><a href="#">까페리얼</a></li>
						<li><a href="#">워터커피</a></li>
						<li><a href="#">모히또</a></li>
					</ul>
				</li>
				<li class="t2"><a href="#" id="topNavi6">커피용품</a>
					<ul id="topSubm6">
						<li><a href="#">종이컵</a></li>
						<li><a href="#">커피필터</a></li>
						<li><a href="#">머신 등</a></li>
					</ul>
				</li>
				<li class="t1"><a href="#" id="topNavi7">선물세트</a></li>
				<li class="t2"><a href="#" id="topNavi8">대량구매</a></li>
			</ul>
		</div>

		<script type="text/javascript">initTopMenu();</script>
	</div>
	<!-- //GNB -->

	<!-- container -->
	<div id="container">

		<div id="location">
			<ol>
				<li><a href="#">HOME</a></li>
				<li><a href="#">EVENT</a></li>
				<li class="last">진행중 이벤트</li>
			</ol>
		</div>
		
		<div id="outbox">		
			<div id="left">
				<div id="title2">EVENT<span>이벤트</span></div>
				<ul>	
					<li><a href="#" id="leftNavi1">진행중 이벤트</a></li>
					<li><a href="#" id="leftNavi2">종료된 이벤트</a></li>
					<li class="last"><a href="#" id="leftNavi3">당첨자 발표</span></a></li>
				</ul>			
			</div><script type="text/javascript">initSubmenu(1,0);</script>


			<!-- contents -->
			<div id="contents">
				<div id="mypage">
					<h2><strong>진행중 이벤트</strong><span>쟈뎅샵의 특별한 혜택이 가득한 이벤트에 참여해 보세요.</span></h2>
					
					<div class="viewDivMt">
						<div class="viewHead">
							<div class="subject">
								<ul>
									<li>{{board.btitle}}</li>
								</ul>
							</div>
							<div class="day">
								<p class="txt">작성일<span>{{board.bdate|date:'Y-m-d H:i:s'}}</span></p>
							</div>
						</div>

						<div class="viewContents">
							{{board.bcontent}}
							<br>
							<br>
							<img src="/static/images/img/sample_event_view.jpg" alt="" />
						</div>
					</div>


					<!-- 이전다음글 -->
					<div class="pnDiv web">
						<table summary="이전다음글을 선택하여 보실 수 있습니다." class="preNext" border="1" cellspacing="0">
							<caption>이전다음글</caption>
							<colgroup>
							<col width="100px" />
							<col width="*" />
							<col width="100px" />
							</colgroup>
							<tbody>
								<tr>
									<th class="pre">PREV</th>
									<td><a href="#">상품 재입고는 언제 되나요?</a></td>
									<td>&nbsp;</td>
								</tr>

								<tr>
									<th class="next">NEXT</th>
									<td>다음 글이 없습니다.</td>
									<td>&nbsp;</td>
								</tr>
							</tbody>
						</table>
					</div>
					<!-- //이전다음글 -->


					<!-- 댓글-->
					<script>
						$(function(){
							const csrfToken = $("meta[name='csrf-token']").attr("content");
							// 댓글 등록
							$('.replyBtn').click(function(){

								//로그인 체크
								if("{{request.session.session_id}}" == ''){
									alert("로그인을 해야 댓글을 작성할 수 있습니다.")
									location.href='/member/login/'
									return
								}
								
								bno = '{{board.bno}}'
								cpw = $(".replynum").val()
								ccontent = $(".replyType").val()
								//alert("test"+cpw+ccontent)

								$.ajax({
									headers:{"X-CSRFToken":csrfToken},
									url:"/comment/cwrite/",
									type:"post",
									data:{"cpw":cpw,"ccontent":ccontent,"bno":bno},
									success:function(data){
										//console.log("결과 result " + data.result)
										//console.log("결과 comment " + data.comment[0])
										//console.log("결과 cno " + data.comment[0].cno)
										if (data.result == 'success'){
											alert("댓글이 등록되었습니다.")

											// 하단에 댓글 보이게
											let datahtml = ''
											datahtml += `<ul id="${data.comment[0].cno}">`
											datahtml += `<li class="name">{{request.session.session_nickname}} <span>[${data.comment[0].cdate}]</span></li>`
											datahtml += `<li class="txt">${data.comment[0].ccontent}</li>`
											datahtml += `<li class="btn">`
											datahtml += `<a class="uBtn rebtn">수정</a>&nbsp`
											datahtml += `<a class="dBtn rebtn">삭제</a>`
											datahtml += `</li>`
											datahtml += `</ul>`
													
											$(".replyBox").prepend(datahtml)
											//$(".replyBox").append(datahtml)
											//$(".replyBox").html(datahtml)
											// html - html 싹 다 지우고 입력 => 모조리 싹 지우고 모든 데이터 다 보여주면 새로고침안해도 다른곳에서 업데이트 된것이 보임.
											// prepend - 맨 앞에 입력
											// append - 맨 뒤에 입력

											let cnt = $("#cnt").text()
											//console.log("개수 : "+(Number(cnt)+1))
											$("#cnt").text(Number(cnt)+1)

										}else{
											alert("등록에 실패했습니다. 다시 시도하세요.")
										}
									},
									error:function(){
										alert("fail..")
									}

								});//ajax
								// 입력창 초기화
								$(".replynum").val('')
								$(".replyType").val('')

							})//Btn
							
							// 정적 - 처음 불러온 데이터는 가능, 제이쿼리로 나중에 추가한 데이터는 안먹힘.
							// 동적 - 나중에 제이쿼리로 추가된 데이터도 찾아서 진행.

							// 2 댓글 삭제 - 동적클릭
							$(document).on("click",".dBtn",function(){
								let cno = $(this).closest("ul").attr("id")
								if(confirm(cno + " 번댓글을 삭제하시겠습니까?")){
									//ajax
									$.ajax({
										headers:{"X-CSRFToken":csrfToken},
										url:"/comment/cdelete/",
										type:"post",
										data:{"cno":cno},
										success:function(data){
											console.log("결과 result " + data.result)
											if (data.result == 'success'){
												alert(cno + " 번 댓글 삭제되었습니다.")
												$('#'+cno).remove()

												// 댓글 개수 카운트 -> -1 감소
												let cnt = $("#cnt").text()
												//console.log("개수 : "+(Number(cnt)+1))
												$("#cnt").text(Number(cnt)-1)

											}
										},
										error:function(){
											alert("fail..")
										}
									});//ajax
								}//confirm
              }); //삭제 클릭
							
							let cno;
							let id;
							let cdate;
							let ccontent;
							
							
							// 3 댓글 수정 화면
							$(document).on('click','.uBtn',function(){
								cno = $(this).closest("ul").attr("id");
								id = "{{request.session.session_nickname}}";
								cdate = $(this).closest("ul").children(".name").children("span").text();
								ccontent = $(this).closest("ul").children(".txt").text();
								//alert(id)
								
								let datahtml = ''
								datahtml += `<li class="name">${id} <span>${cdate}</span></li>`
								datahtml += `<li class="txt"><textarea class="replyType">${ccontent}</textarea></li>`
								datahtml += `<li class="btn">`
								datahtml += `<a class="sBtn rebtn">저장</a>&nbsp`
								datahtml += `<a class="cBtn rebtn">취소</a>`
								datahtml += `</li>`
								
								$("#"+cno).html(datahtml);
								
							});//uBtn
							
							// 4 댓글 수정 취소버튼
							$(document).on('click','.cBtn',function(){
								let cno = $(this).closest("ul").attr("id");
								let id = "{{request.session.session_nickname}}";
								let cdate = $(this).closest("ul").children(".name").children("span").text();
								let ccontent = $(this).closest("ul").children(".txt").text();
								
								// 댓글 등록부분과 같게.
								let datahtml = ''
								datahtml += `<li class="name">{{request.session.session_nickname}} <span>[${cdate}]</span></li>`
								datahtml += `<li class="txt">${ccontent}</li>`
								datahtml += `<li class="btn">`
									datahtml += `<a class="uBtn rebtn">수정</a>&nbsp`
								datahtml += `<a class="dBtn rebtn">삭제</a>`
								datahtml += `</li>`
								
								$("#"+cno).html(datahtml);
								
							});//cBtn							
							
							
							// 4 댓글 수정 저장버튼
							$(document).on('click','.sBtn',function(){
								let cno = $(this).closest("ul").attr("id");
								let ccontent = $(this).closest("ul").children(".txt").children(".replyType").val();
								
								//ajax
								$.ajax({
									headers:{"X-CSRFToken":csrfToken},
									url:"/comment/cupdate/",
									type:"post",
									data:{"ccontent":ccontent,"cno":cno},
									success:function(data){
										console.log("결과 result " + data.result)
										console.log("결과 comment " + data.comment[0])
										console.log("결과 cno " + data.comment[0].cno)
										console.log("결과 cno " + data.comment[0].ccontent)

										if (data.result == 'success'){
											alert("댓글이 수정되었습니다.")

											// 하단에 댓글 보이게
											let datahtml = ''
											datahtml += `<li class="name">{{request.session.session_nickname}} <span>[${data.comment[0].cdate}]</span></li>`
											datahtml += `<li class="txt">${data.comment[0].ccontent}</li>`
											datahtml += `<li class="btn">`
											datahtml += `<a class="uBtn rebtn">수정</a>&nbsp`
											datahtml += `<a class="dBtn rebtn">삭제</a>`
											datahtml += `</li>`
													
											$("#"+cno).html(datahtml)
										}else{
											alert("수정에 실패했습니다. 다시 시도하세요.")
										}
									},
									error:function(){
										alert("fail..")
									}

								});//ajax
																						
								
							});//sBtn							


						});//jquery
					</script>
					<div class="replyWrite">
						<ul>
							<li class="in">
								<p class="txt">총 <span class="orange" id="cnt">{{clist.count}}</span> 개의 댓글이 달려있습니다.</p>
								<p class="password">비밀번호&nbsp;&nbsp;<input type="password" class="replynum" /></p>
								<textarea class="replyType"></textarea>
							</li>
							<li class="btn"><a class="replyBtn">등록</a></li>
						</ul>
						<p class="ntic">※ 비밀번호를 입력하시면 댓글이 비밀글로 등록 됩니다.</p>
					</div>

					<div class="replyBox">
						{% if clist %}
							{% for comment in clist %}
								<ul id="{{comment.cno}}">
									<li class="name">{{comment.member.nickname}} <span>[{{comment.cdate|date:'y-m-d h:m:i'}}]</span></li>
									{% if request.session.session_id != comment.member.id and comment.cpw != null %}
										<li class="txt">
											<a href="password.html" class="passwordBtn"><span class="orange">※ 비밀글입니다.</span></a>
										</li>
									{% else %}
										<li class="txt">{{comment.ccontent}}</li>
										{% if request.session.session_id == comment.member.id %}
											<li class="btn">
												<a class="uBtn rebtn">수정</a>
												<a class="dBtn rebtn">삭제</a>
											</li>
										{% endif %}
									{% endif %}
								</ul>
							{% endfor %}
						{% else %}
						<ul>
							<li>댓글이 없습니다.</li>
						</ul>
						{% endif %}

						<!-- 비밀글 페이지 
						<ul>
							<li class="name">jjabcde <span>[2014-03-04&nbsp;&nbsp;15:01:59]</span></li>
							<li class="txt">
								<a href="password.html" class="passwordBtn"><span class="orange">※ 비밀글입니다.</span></a>
							</li>
						</ul>
						-->
					</div>
					<!-- //댓글 -->


					<!-- Btn Area -->
					<div class="btnArea">
						<div class="bRight">
							<ul>
								<li><a href="#" class="sbtnMini mw">목록</a></li>
							</ul>
						</div>
					</div>
					<!-- //Btn Area -->
					
				</div>
			</div>
			<!-- //contents -->


<script type="text/javascript" src="../js/jquery.fancybox-1.3.4.pack.js"></script>
<link rel="stylesheet" type="text/css" href="../css/jquery.fancybox-1.3.4.css" />
<script type="text/javascript">
$(function(){
	
	var winWidth = $(window).width();
	if(winWidth > 767){
		var layerCheck = 540;
	}else{
		var layerCheck = 320;
	}

	$(".passwordBtn").fancybox({
		'autoDimensions'    : false,
		'showCloseButton'	: false,
		'width' : layerCheck,
		'padding' : 0,
		'type'			: 'iframe',
		'onComplete' : function() {
			$('#fancybox-frame').load(function() { // wait for frame to load and then gets it's height
			$('#fancybox-content').height($(this).contents().find('body').height());
			});
		}
	});


});
</script>

		</div>
	</div>
	<!-- //container -->




	<div id="footerWrap">
		<div id="footer">
			<div id="fnb">
				<ul>
					<li class="left"><a href="#">개인정보취급방침</a></li>
					<li><a href="#">이용약관</a></li>
					<li class="left"><a href="#">이메일무단수집거부</a></li>
					<li><a href="#">고객센터</a></li>
					<li class="left brand"><a href="#">쟈뎅 브랜드 사이트</a></li>
				</ul>
			</div>
			
			<div id="finfo">
				<div id="flogo"><img src="/static/images/txt/flogo.gif" alt="JARDIN THE COFFEE CREATOR, SINCE 1984" /></div>
				<address>
					<ul>
						<li>㈜쟈뎅</li>
						<li>대표자 윤영노</li>
						<li class="tnone">주소 서울시 강남구 논현동 4-21번지 영 빌딩</li>
						<li class="webnone">소비자상담실 02)546-3881</li>
						<li>사업자등록번호 211-81-24727</li>
						<li class="tnone">통신판매신고 제 강남 – 1160호</li>
						<li class="copy">COPYRIGHT © 2014 JARDIN <span>ALL RIGHTS RESERVED.</span></li>
					</ul>
				</address>

				<div id="inicis"><img src="/static/images/ico/ico_inicis.png" alt="이니시스 결제시스템" /></div>
			</div>
		</div>
	</div>



</div>
</div>
</body>
</html>